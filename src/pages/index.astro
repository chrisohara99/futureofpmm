---
import Base from '../layouts/Base.astro';
import { getCollection } from 'astro:content';

// Get all posts sorted by date
const posts = await getCollection('posts');
const sortedPosts = posts.sort((a, b) => 
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);
---

<Base title="Home">
  {sortedPosts.length === 0 ? (
    <article>
      <h2>Coming Soon</h2>
      <p class="meta">First issue drops Monday</p>
      <div class="content">
        <p>Future of PMM is a weekly brief on how AI is transforming product marketing â€” the tools, the trends, and what it means for your role.</p>
        <p>Subscribe above to get the first issue.</p>
      </div>
    </article>
  ) : (
    sortedPosts.map((post) => (
      <article>
        <span class={`category-tag category-${post.data.category}`}>
          {post.data.category}
        </span>
        <h2><a href={`/posts/${post.slug}`}>{post.data.title}</a></h2>
        <p class="meta">{new Date(post.data.date).toLocaleDateString('en-US', { 
          weekday: 'long',
          year: 'numeric', 
          month: 'long', 
          day: 'numeric' 
        })}</p>
        <div class="content">
          <p>{post.data.excerpt}</p>
        </div>
      </article>
    ))
  )}
</Base>
